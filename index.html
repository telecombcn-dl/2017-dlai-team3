<!DOCTYPE HTML>
<html>
	<head>
		<title>Audio2Faces</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-xlarge.css" />
		</noscript>
	</head>
	<body id="top">

		<!-- Header -->
		<header id="header" class="skel-layers-fixed">
			<h1><a href="#">TOP</a></h1>
			<nav id="nav">
				<ul>
					<li><a href="http://35.205.152.112:9090/notebooks/Checkpoint1.ipynb">JNotebook 1</a></li>
					<li><a href="http://35.205.152.112:9090/notebooks/Checkpoint2.ipynb">JNotebook 2</a></li>
					<li><a href="https://docs.google.com/presentation/d/1i9X-fPDfjBX5CcmDRsyYhzLbjXMfhw8-9sB-Cx_A_fc/edit?usp=sharing">Slides</a></li>
					<li><a href="#authors">Authors</a></li>
					<li><a href="#introduction">Introduction</a></li>
 					<li><a href="#dataset">Dataset generation</a></li>
					<li><a href="#architecture">Architecture</a></li>
					<li><a href="#problems_solutions">Problems and Solutions</a></li>
					<li><a href="#future_work">Future Work</a></li>
					<li><a href="#references">References</a></li>
				</ul>
			</nav>
		</header>

		<!-- Banner -->
		<section id="banner">
			<div class="inner">
				<h2>DLAI Team 3 - Audio2Faces</h2>
			</div>
		</section>

		<!-- One -->
		<section id="authors" class="wrapper style1">
			<header class="major">
					<h2>Authors</h2>
			</header>

			<div class="container">
				<div class="row">
					<div class="3u">
						<section class="special box">
							<a href="https://www.linkedin.com/in/alejandro-woodward-a21a46100" class="image fit"><img src="images/AlejandroWoodward.jpg" alt="" /></a>
							<p>Alejandro Woodward</p>
						</section>
					</div>
					<div class="3u">
						<section class="special box">
							<a href="https://www.linkedin.com/in/irina-sánchez-muriana-65204311b/" class="image fit"><img src="images/irina.jpeg" alt="" /></a>
							<p>Irina Sánchez</p>
						</section>
					</div>
					<div class="3u">
						<section class="special box">
							<a href="https://www.linkedin.com/in/gen%C3%ADs-floriach-pigem-b74715b8/" class="image fit"><img src="images/genis.jpeg" alt="" /></a>
							<p>Genís Floriach</p>
						</section>
					</div>
					<div class="3u">
						<section class="special box">
							<a href="https://www.linkedin.com/in/oriol-vila-clarà-043867b9/" class="image fit"><img src="images/oriol.jpeg" alt="" /></a>
							<p>Oriol Vila</p>
						</section>
					</div>
				</div>
			</div>
		</section>

		<!-- Three -->
		<section id="introduction" class="wrapper style1">
			<header class="major">
				<h2>Introduction</h2>
			</header>
			<div class="container">
				<div class="row">
					<div class="6u">
						<section>
							<h2>Abstract</h2>
							<a class="image fit"><img src="images/2.png" alt="" /></a>
							<p> Our idea is to generate a talking face from an audio segment by using Generative Adversarial Networks (GANs). The architecture used is the proposed by David Berthelot, Thomas Schumm and Luke Metz in their work [Boundary Equilibrium Generative Adversarial Network (BEGAN)](https://arxiv.org/pdf/1703.10717.pdf).
							In our case, the input to the Generator network will be the audio features of an audio segment. Those features are obtained by passing the MFCC coefficients of the audio segment through a shallow CNN architecture. By doing that, we provide information to the generator network to be able to generate a face according to the provided audio segment.</p>
						</section>
					</div>
					<div class="6u">
						<section>
							<h3>Dataset</h3>
							<a class="image fit"><img src="images/3.png" alt="" /></a>
							<p>In order to train our network, we have also created our own dataset as we did not found any suitable one for our task. The goal was to generate a colection of Donal Trump face images with its asociated audio.
							To do so, first we extracted videos from the youtube platform. Then, we cropped them on the parts where Trump was speaking and we extracted the images and audio using a python script that we developed for such task.
							We wanted to have well centered faces and with the cleanest audio possible, for that reason we chosed to download videos from Donald Trump public speeches.
							Once the videos were selected, we had to process them to obtain both the face and the audio corresponding to the face. </p>
						</section>
					</div>
				</div>
			</div>
		</section>			

		<section id="dataset" class="wrapper style1">
			<header class="major">
				<h2>Dataset generation</h2>
			</header>
			<div class="container">
				<div class="row">
					<div class="7u">
						<section>
							<h2>Audio</h2>
							<a class="image fit"><img src="images/6.png" alt="" /></a>
							<p> Raw audio data is usually not useful for classification tasks as audio frames have very high dimensionality and the samples are very correlated. So for each frame we need to extract the most important features.
							A good way to do so is to compute the Mel-frequency cepstral coefficients for each audio frame. MFCC are easy to compute, widely used in stat of the art applications and with a very good performance.
							The MFCC values are made up of individual coefficient each representing a specific frequency band of the audio short-term power on a non-linear Mel scale of frequency.
							As the input videos provides us with a 30 faces per second, we decided to get 35ms audio frames to avoid overlapping and 60ms frames to get 50% overlapping. For each audio frame we compute the MFCC coefficients on a sliding window with 50% overlap so we obtain a 2D heat map for every audio frame that shows the evolution of the MFCC.</p>
						</section>
					</div>
					<div class="5u">
						<section>
							<h2>Faces</h2>
							<a class="image fit"><img src="images/12.jpeg" alt="" /></a>
							<p> In order to extract the face we resorted to the well known library for computer vision [OpenCV](https://opencv.org/). 
							Using this library we extracted each frame of the video, then we processed each frame independently to extract the face. 
							On the first iteration of our project we used the Viola Jones face detector. It worked pretty well but had some problems 
							such as a high false positive rate and the fact that the faces where not centered inside the bounding box. 
							To overcome this drawbacks and obtain a better dataset with less variance we changed the face detection algorithm. <br>
							In this case, we used the algorithm proposed by Kaipeng Zhang et al. in [Joint Face Detection and Alignment using Multi-Task Cascaded Convolutional Networks]. 
							This algorithm not only detects faces but also aligns them, providing then a more homogeneous dataset which will make our final task easier.
							In a nutshell, the method proposed consists of 3 stages. In the first stage, it produces candidate windows quickly through a shallow CNN. 
							Then, it refines the windows to reject a large number of non-faces. Finally, it uses a more powerful CNN to refine the result and ouput facial landmarks that will be used to align the face. All these 3 process are done at different scale levels. <br>
							A tensorflow implementation of this algorithm can be found here: <a href="https://github.com/kpzhang93/MTCNN_face_detection_alignment/">https://github.com/kpzhang93/MTCNN_face_detection_alignment/</a></p>
						</section>
					</div>
				</div>
			</div>
		</section>

		<section id="architecture" class="wrapper style1">
			<header class="major">
				<h2>Architecture</h2>
			</header>
			<div class="container">
				<div class="row">
					<div class="6u">
						<section>
							<h2>First approach: BEGAN Architecture</h2>
							<a class="image fit"><img src="images/1.png" alt="" /></a>
							<p> The architecture proposed in the [Boundary Equilibrium Generative Adversarial Network (BEGAN)](https://arxiv.org/pdf/1703.10717.pdf) is quite different to the general way of building GANs. In this case, we have that the architecture used for the Discriminator network is an autoencoder, while the Generator has only the decoder part. In order to conditioned the Generator network to generate talking faces according to an audio segment, our first approach to solve the problem was to input to the generator audio features instead of a random noise. Those features have been extracted from a CNN which had as an input the audio segment. This CNN is composed by: Conv (3x3,64) + Conv (3x3,128) + Pool(2)  + Conv (3x3,256) + Conv (3x3,512) + Dense(512) + Dense (256).</p>
						</section>
					</div>
					<div class="6u">
						<section>
							<h2>Variational Autoencoder</h2>
							<a class="image fit"><img src="images/11.png" alt="" /></a>
							<p> The aim of an autoencoder is to learn a representation (encoding) for a set of data, typically for the purpose of dimensionality reduction. We use this to extract features from the MFCC coeficients in order to ease the task for the main network.  If the feature extractor weights are learned at the same time that the generator is trained, the discriminator will have even more advantage.</p>
						</section>
					</div>
				</div>

			</div>
		</section>

		<section id="problems_solutions" class="wrapper style1">
			<header class="major">
				<h2>Problems and solutions</h2>
			</header>
			<div class="container">
				<div class="row">
					<div class="12u">
						<section>
							<h2>First solution</h2>
							<a class="image fit"><img src="images/4.png" alt="" /></a>
							<p> The training of the system was not as straightforward as we thought. We had to face some problems during the training phase and the generation of the dataset.
							During training, the Generator's output was always the same in a batch, so we had a mode collapse problem. </p>
							<p>In this image we can see at the left, the faces generated by the Generator network. Each one of the rows correspond to a batch, so we are showing two samples for each batch. As can be seen, the faces generated in each of the batches are the same within the batch. To the right, we have at the top the input image and below the images generated by the Discriminator network (Remember that the Discriminator in the BEGAN architecture is an autoencoder, so it also generates images).</p>
						</section>
					</div>
				</div>
				<div class="row">
					<div class="8u">
						<h2>Second solution</h2>
						<section>
							<p> In order to overcome the situation, we concatenate to the input audio features a random noise. The reason is that audio features were very similar between each other, so maybe the network was not able to obtain enough information and so it fails in generating different images. The introduction of a random sequence to the input, was thought to provide this variability and so improve the results. But... it also failed.</p>
							<a class="image fit"><img src="images/5.png" alt="" /></a>
							<p>Here we can see that we still generate the same samples within the batch, and what is more, the Generator network at some point fails completely, and it is not able to ouput faces anymore.
							We decided to finally simplify the network, and input only noise to the generator network. That would be, generate different Trump faces without any audio condition. 
							We can see here the evolution of the variable Kt and MGlobal. As can be seen MGlobal decreases, so the generator is able to generate more realistic faces, but, we still generate the same face...</p>
						</section>
					</div>
					<div class="4u">
						<h2>Third solution</h2>
						<section>
							<a class="image fit"><img src="images/7.png" alt="" /></a>
							<a class="image fit"><img src="images/8.png" alt="" /></a>
							<a class="image fit"><img src="images/output_XxVvWq.gif" alt="" /></a>
							<p>The last trick we tried to overcome the situation, was to reduce even more the learning rate and also reduce the batch size to just one image. In that case we were able in training time to generate faces from both of the videos used for training (previously the network was only generating a face corresponding to one of the videos). But finally, when testing we were again generating the same face.</p>
						</section>
					</div>

				</div>
				<div class="row">
					<div class="6u">
						<section>
							<h2>Fourth solution</h2>
								<a class="image fit"><img src="images/solution4.png" alt="" /></a>
								<p> We tried to reduce even more the learning rate and we applied a batch size of just one image. During training we were able to observe images from both videos used in the dataset. In previous trainings we were able to generate an image that looked like just one of the videos. But, finally, at test time we could just generate the same image. </p>

						</section>
					</div>
				</div>
			</div>
		</section>
		
		<section id="Final approach: Audio2Faces" class="wrapper style1">
			<header class="major">
				<h2>Final approach: Audio2Faces</h2>
			</header>
			<div class="container">
				<p>As any of the solutions that we have been trying were able to overcome the Mode Collapase situation, we had to rethink the idea. For that reason, our final solution was a totally different approach from our initial one.</p>
				<p> The Audio2Faces method consists on training two different networks:</p>
				<p>The first network is a Convolutional Neural Network trained using a MSE loss. Using a MSE loss produces blurry images, because the output provided is the mean of all the different possibilities of a position of a face. Due to that, if we train the network with a dataset with faces looking to the right and to the left, the output provided looks like a mix of two faces, each one looking to a different direction. So our first task was to process the dataset to flip all faces looking to the right. For doing that, we compare the histogram of the left part of the image with a mean of histograms, in the same position, of faces correctly positioned. We set a threshold of similarity, and when the distance between histograms was higher than the threshold, the images were flipped.</p>
				<p>In order to sharpened the images and made them more realistic, as second network we introduced a modification of the BEGAN architecture. Taking advantage of the realism and high quality faces provided by this network, we modified the architecture of the generator to be able to have as an input the blurry face predicted by the first CNN. By using skip connections that helps data flow and preserves information of previous layers, we output a better representation (in terms of realism of images) of the input image. 
				</p>
				<a class="image fit"><img src="images/A2F_arch.png" alt="" /></a>
				<a class="image fit"><img src="images/A2F_solutions.png" alt="" /></a>
			</div>
		</section>
		
		<section id="future_work" class="wrapper style1">
			<div class="container">
				<div class="row">
					<div class="6u">
						<section>
							<h2>Future work</h2>
							<p>We would like to continue with the project in order to finally be able to train the GAN using also the variational autoencoder.  We would also like to test different architectures as LSGAN or SRGAN.  The main objective will be to solve the problem of the mode collapse.</p>
						</section>
					</div>
					<div class="6u">
						<section>
							<h2>Jupyter notebook and slides</h2>
							<p> Do you want to try our code? Here we have two jupyter notebooks that will allow you to generate two different Trump faces:
							<a href="http://35.205.152.112:9090/notebooks/Checkpoint1.ipynb">http://35.205.152.112:9090/notebooks/Checkpoint1.ipynb</a></p>
							<a href="http://35.205.152.112:9090/notebooks/Checkpoint2.ipynb">http://35.205.152.112:9090/notebooks/Checkpoint2.ipynb</a></p>
							Also, you can access to our slides using this link: <a href="https://docs.google.com/presentation/d/1i9X-fPDfjBX5CcmDRsyYhzLbjXMfhw8-9sB-Cx_A_fc/edit?usp=sharing">LINK</a></p>
						</section>
					</div>
				</div>
			</div>
		</section>
		
		<section id="references" class="wrapper style2">
			<div class="container">
				<div class="row">
					<div class="6u">
						<section>
							<h2>References</h2>
							<p> [1] David Berthelot, Thomas Schumm, Luke Metz [Boundary Equilibrium Generative Adversarial Network (BEGAN)](https://arxiv.org/pdf/1703.10717.pdf) 
							</p>
							<p> [2] Kaipeng Zhang et al. “Joint Face Detection and Alignment using Multi-task Cascaded Convolutional Networks” (2016) https://arxiv.org/ftp/arxiv/papers/1604/1604.02878.pdf
						</section>
					</div>
				</div>
			</div>
		</section>

	</body>
</html>
